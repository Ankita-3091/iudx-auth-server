<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="626px" preserveAspectRatio="none" style="width:1027px;height:626px;" version="1.1" viewBox="0 0 1027 626" width="1027px" zoomAndPan="magnify"><defs><filter height="300%" id="f1t942ge0ujaxw" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[3105e977017215c62956ee5c147722ae]
class policy--><rect fill="#F8F8F8" filter="url(#f1t942ge0ujaxw)" height="78.3828" id="policy" style="stroke: #383838; stroke-width: 1.5;" width="896" x="63" y="8"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="35" x="493.5" y="24.1387">policy</text><line style="stroke: #383838; stroke-width: 1.5;" x1="64" x2="958" y1="31.9688" y2="31.9688"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="10" x="69" y="46.1792">id</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="197" y="46.1792">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="325" y="46.1792">PRIMARY KEY</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="532" x="421" y="46.1792">// The id of the provider in the format : domain-of-email/hex-of-sha1-of-email-id in lower case</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="32" x="69" y="58.9839">policy</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="100" x="197" y="58.9839">varchar(3145728)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="325" y="58.9839">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="381" x="421" y="58.9839">// The access control policy in aperture language; base64 encoded</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="78" x="69" y="71.7886">policy_in_json</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="197" y="71.7886">jsonb</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="325" y="71.7886">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="409" x="421" y="71.7886">// The complied version of aperture access control policy in json format</text><line style="stroke: #383838; stroke-width: 1.5;" x1="64" x2="958" y1="78.3828" y2="78.3828"/><!--MD5=[606c0e9a527600b962089599cf14ab26]
class token--><rect fill="#F8F8F8" filter="url(#f1t942ge0ujaxw)" height="206.4297" id="token" style="stroke: #383838; stroke-width: 1.5;" width="1010" x="6" y="146"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="36" x="493" y="162.1387">token</text><line style="stroke: #383838; stroke-width: 1.5;" x1="7" x2="1015" y1="169.9688" y2="169.9688"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="10" x="12" y="184.1792">id</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="140" y="184.1792">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="184.1792">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="382" x="332" y="184.1792">// the consumer's email in lower case to whom the token is issued</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="12" y="196.9839">token</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="140" y="196.9839">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="196.9839">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="224" x="332" y="196.9839">// the sha256 hash of the access token</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="34" x="12" y="209.7886">expiry</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="61" x="140" y="209.7886">timestamp</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="209.7886">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="110" x="332" y="209.7886">// token expiry time</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="44" x="12" y="222.5933">request</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="140" y="222.5933">jsonb</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="222.5933">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="428" x="332" y="222.5933">// the actual request sent by the consumer when this token was requested</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="60" x="12" y="235.3979">cert_serial</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="140" y="235.3979">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="235.3979">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="452" x="332" y="235.3979">// the serial number of consumer's certificate which was used to get this token</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="87" x="12" y="248.2026">cert_fingerprint</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="140" y="248.2026">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="248.2026">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="463" x="332" y="248.2026">// the sha1 fingerprint of consumer's certificate which was used to get this token</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="55" x="12" y="261.0073">issued_at</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="61" x="140" y="261.0073">timestamp</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="261.0073">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="239" x="332" y="261.0073">// the time at which this token was issued</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="74" x="12" y="273.812">resource_ids</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="140" y="273.812">jsonb</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="273.812">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="302" x="332" y="273.812">// the list of resource ids for which this token is valid</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="71" x="12" y="286.6167">introspected</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="45" x="140" y="286.6167">boolean</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="286.6167">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="483" x="332" y="286.6167">// true if ths token has been introspected/checked by a resource server atleast once</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="45" x="12" y="299.4214">revoked</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="45" x="140" y="299.4214">boolean</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="299.4214">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="309" x="332" y="299.4214">// true if the token has been revoked by the consumer</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="58" x="12" y="312.2261">cert_class</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="40" x="140" y="312.2261">integer</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="312.2261">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="440" x="332" y="312.2261">// the certificate class of the consumer which was used to request this token</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="74" x="12" y="325.0308">server_token</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="140" y="325.0308">jsonb</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="325.0308">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="283" x="332" y="325.0308">// a dictionary of sha256 hashes of server-tokens</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="54" x="12" y="337.8354">providers</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="140" y="337.8354">jsonb</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="236" y="337.8354">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="678" x="332" y="337.8354">// a dictionary of providers for which this token is valid. providers[P] = false if the token was revoked by the provider P</text><line style="stroke: #383838; stroke-width: 1.5;" x1="7" x2="1015" y1="344.4297" y2="344.4297"/><!--MD5=[0d2656fadf7191851afd801497368241]
class groups--><rect fill="#F8F8F8" filter="url(#f1t942ge0ujaxw)" height="91.1875" id="groups" style="stroke: #383838; stroke-width: 1.5;" width="832" x="95" y="412"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="44" x="489" y="428.1387">groups</text><line style="stroke: #383838; stroke-width: 1.5;" x1="96" x2="926" y1="435.9688" y2="435.9688"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="10" x="101" y="450.1792">id</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="197" y="450.1792">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="293" y="450.1792">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="532" x="389" y="450.1792">// The id of the provider in the format : domain-of-email/hex-of-sha1-of-email-id in lower case</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="57" x="101" y="462.9839">consumer</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="197" y="462.9839">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="293" y="462.9839">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="216" x="389" y="462.9839">// the consumer's email in lower case</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="71" x="101" y="475.7886">group_name</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="197" y="475.7886">varchar</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="293" y="475.7886">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="220" x="389" y="475.7886">// the name of the group in lower case</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="45" x="101" y="488.5933">valid_till</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="61" x="197" y="488.5933">timestamp</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="293" y="488.5933">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="310" x="389" y="488.5933">// indicates how long a consumer is to be in the group</text><line style="stroke: #383838; stroke-width: 1.5;" x1="96" x2="926" y1="495.1875" y2="495.1875"/><!--MD5=[e6ebd47dfd9b394ed517a8f9d34bd03e]
class crl--><rect fill="#F8F8F8" filter="url(#f1t942ge0ujaxw)" height="52.7734" id="crl" style="stroke: #383838; stroke-width: 1.5;" width="493" x="264.5" y="563"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="15" x="503.5" y="579.1387">crl</text><line style="stroke: #383838; stroke-width: 1.5;" x1="265.5" x2="756.5" y1="586.9688" y2="586.9688"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="270.5" y="601.1792">crl</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="31" x="302.5" y="601.1792">jsonb</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="366.5" y="601.1792">NOT NULL</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="158" x="462.5" y="601.1792">DEFAULT VALUE = '[]'::jsonb</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="97" x="654.5" y="601.1792">// CRL of IUDX CA</text><line style="stroke: #383838; stroke-width: 1.5;" x1="265.5" x2="756.5" y1="607.7734" y2="607.7734"/><!--MD5=[f4865c0efd73d94b3f0b9eb1aa734669]
link policy to token--><!--MD5=[ded119f31d0e8159f5dafa27dfb53545]
link token to groups--><!--MD5=[7291062458606fc17de4a2b597c0a9e9]
link groups to crl--><!--MD5=[fae646c01511f2283081b0668a728821]
@startuml
skinparam monochrome true
hide circle

entity policy {
	id				varchar			PRIMARY KEY	// The id of the provider in the format : domain-of-email/hex-of-sha1-of-email-id in lower case
	policy			varchar(3145728)	NOT NULL		// The access control policy in aperture language; base64 encoded
	policy_in_json		jsonb				NOT NULL		// The complied version of aperture access control policy in json format
}

entity token {
	id				varchar		NOT NULL		// the consumer's email in lower case to whom the token is issued
	token				varchar		NOT NULL		// the sha256 hash of the access token
	expiry			timestamp		NOT NULL		// token expiry time
	request			jsonb			NOT NULL		// the actual request sent by the consumer when this token was requested
	cert_serial			varchar		NOT NULL		// the serial number of consumer's certificate which was used to get this token
	cert_fingerprint		varchar		NOT NULL		// the sha1 fingerprint of consumer's certificate which was used to get this token 
	issued_at			timestamp		NOT NULL		// the time at which this token was issued
	resource_ids		jsonb			NOT NULL		// the list of resource ids for which this token is valid
	introspected		boolean		NOT NULL		// true if ths token has been introspected/checked by a resource server atleast once
	revoked			boolean		NOT NULL		// true if the token has been revoked by the consumer
	cert_class			integer		NOT NULL		// the certificate class of the consumer which was used to request this token
	server_token		jsonb			NOT NULL		// a dictionary of sha256 hashes of server-tokens
	providers			jsonb			NOT NULL		// a dictionary of providers for which this token is valid. providers[P] = false if the token was revoked by the provider P
}

entity groups {
	id			varchar		NOT NULL		// The id of the provider in the format : domain-of-email/hex-of-sha1-of-email-id in lower case
	consumer		varchar		NOT NULL		// the consumer's email in lower case
	group_name	varchar		NOT NULL		// the name of the group in lower case
	valid_till		timestamp		NOT NULL		// indicates how long a consumer is to be in the group
}

entity crl {
	crl	jsonb		NOT NULL		DEFAULT VALUE = '[]'::jsonb		// CRL of IUDX CA
}

policy -[hidden]- token 
token -[hidden]- groups 
groups -[hidden]- crl
@enduml

PlantUML version 1.2020.00(Sat Jan 11 18:00:53 IST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.6+10-1
Operating System: OpenBSD
Default Encoding: US-ASCII
Language: en
Country: US
--></g></svg>