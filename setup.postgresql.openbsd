#!/bin/sh

cd /home/postgresql

initdb -D /home/postgresql/data/ -U postgres --auth=md5 --encoding=UTF-8 --pwfile=admin.db.password
pg_ctl -D /home/postgresql/data/ -l logfile start

echo "--- start pg_hba.conf"
cat /home/postgresql/data/pg_hba.conf | grep -v '#'
echo "--- end pg_hba.conf"

until pg_isready -h 127.0.0.1
do
	sleep 1
done

export PGPASSWORD=`cat admin.db.password`

psql -U postgres < schema.sql

rm -rf schema.sql
rm -rf setup.postgresql.openbsd
